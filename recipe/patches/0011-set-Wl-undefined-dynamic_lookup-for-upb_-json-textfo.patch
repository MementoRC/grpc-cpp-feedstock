From 3a051669b869fadb09dcafaa3197a15b65cb6d7f Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Tue, 16 Jul 2024 17:40:18 +1100
Subject: [PATCH 11/11] set `-Wl,-undefined,dynamic_lookup` for
 `upb_{json,textformat}_lib` on osx

---
 CMakeLists.txt | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index d35646c345..57a8d326d8 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -3663,6 +3663,9 @@ if(WIN32 AND MSVC)
       DESTINATION ${gRPC_INSTALL_LIBDIR} OPTIONAL
     )
   endif()
+elseif(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
+  # see https://github.com/grpc/grpc/issues/36654
+  target_link_options(upb_json_lib PRIVATE -Wl,-undefined,dynamic_lookup)
 endif()
 
 target_include_directories(upb_json_lib
@@ -3876,6 +3879,9 @@ if(WIN32 AND MSVC)
       DESTINATION ${gRPC_INSTALL_LIBDIR} OPTIONAL
     )
   endif()
+elseif(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
+  # see https://github.com/grpc/grpc/issues/36654
+  target_link_options(upb_textformat_lib PRIVATE -Wl,-undefined,dynamic_lookup)
 endif()
 
 target_include_directories(upb_textformat_lib
